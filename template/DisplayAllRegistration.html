<!DOCTYPE html>
<style type="text/css">
     .droot{
        width:100%;
        height:auto;
        background:#f5f6fa;
        justify-content: center;
        display:flex;
        align-items: center
   }
    .dsubdiv{

        width: auto;
        height: auto;
        background: #7f8fa6;
        padding: 15px;
        border-radius: 10px;

    }
    .dhead{
        font-size: 24px;
        font-weight: bold;
        letter-spacing: 2px;
        color:#000;
        display: flex;
        align-items: center;

   }

    .root{
        width:auto;
        height:100vh;
        background:#f5f6fa;
        justify-content: center;
        display:flex;
        align-items: center;
        flex-wrap: wrap;
   }
    .subdiv{

        width: auto;
        height: auto;
        background: #7f8fa6;
        padding: 15px;
        border-radius: 10px;


    }
    .head{
        font-size: 32px;
        font-weight: bold;
        letter-spacing: 2px;
        color:#FFF;
        display: flex;
        justify-content:center;
        align-items: center;
        flex-wrap: wrap;

   }
   .tbtexthead{
        color: white;
        font-weight: bolder;
        font-size: 24px;
    }

    .tbtext{
        color: white;
        font-weight: bold;
        font-size: 18px;
    }




</style>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registration</title>
    <!-- Font Awesome -->
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
  rel="stylesheet"
/>
<!-- Google Fonts -->
<link
  href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
  rel="stylesheet"
/>
<!-- MDB -->
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.2/mdb.min.css"
  rel="stylesheet"
/><!-- MDB -->
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.2/mdb.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" ></script>

</head>

<body>
<div class="root">
    <div class="subdiv">
        <div class="head">
            List Doctor Registration
        </div>
        <table class="table align-middle">
            <thead class="tbtexthead">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Doctor Name</th>
                <th scope="col">DOB</th>
                <th scope="col">Gender</th>
                <th scope="col">Mobile NO</th>
                <th scope="col">Email</th>
                <th scope="col">Specialization</th>
                <th scope="col">Picture</th>
                <th scope="col">#</th>

            </tr>
            </thead>

            <tbody class="tbtext">
            <tr>
                {% for row in result %}
                <th scope="row">{{ row.doctorid }}</th>
                <td> {{ row.doctorname }}</td>
                <td> {{ row.dob }}</td>
                <td> {{ row.gender }}</td>
                <td> {{ row.mobileno }}</td>
                <td> {{ row.email }}</td>
                <td> {{ row.tspecialization }}</td>
                <td>
                    <button type="button" doctorid={{ row.doctorid }} iconspl={{ row.picture }}
                            class="btnicon btn-light btn-sm px-3" data-mdb-toggle="modal" data-mdb-target="#iconModal">

                        <img
                                src="/static/{{ row.picture }}"
                                class="img-fluid rounded"
                                alt="Townhouses and Skyscrapers"
                                style="width: 40px"
                        />
                    </button>
                </td>
                <td>
                    <button type="button" doctorid={{ row.doctorid }} doctorname='{{ row.doctorname }}'
                            dob='{{ row.dob }}'
                            gender={{ row.gender }} number={{ row.mobileno }} email={{ row.email }} specialization={{ row.specialization }} tspecialization="{{ row.tspecialization }}"
                            class="btnedit btn-light btn-sm px-3" data-mdb-toggle="modal"
                            data-mdb-target="#exampleModal">
                        <i class="fas fa-edit"></i>
                    </button>

                </td>
            </tr>
            {% endfor %}

            </tbody>
        </table>

    </div>
</div>

<!--Dialogue-->
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">

                <div class="dhead modal-title">
                    <span><img src="/static/logo1.png" width="80"></span>
                    <span style="padding-left: 10px">Doctor Registration</span>
                </div>
                <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class=droot">
                    <div class="dsubdiv">

                        <div class="row" style="margin-top: 10px">
                            <div class="col-12">
                                <div class="form-outline form-white">
                                    <input type="text" name="doctorid" id="doctorid"  class="form-control form-control-lg" disabled/>
                                    <label class="form-label" for="doctorid">Doctor Id</label>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 10px">
                            <div class="col-12">
                                <div class="form-outline form-white">
                                    <input type="text" name="doctorname" id="doctorname"
                                           class="form-control form-control-lg"/>
                                    <label class="form-label" for="doctorname">Doctor Name</label>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top:8px">
                            <div class="col-12 align-items-center">

                                <div class="form-outline datepicker w-100 form-white">
                                    <input
                                            type="text"
                                            class="form-control form-control-lg"
                                            id="dob"
                                            name="dob"
                                    />
                                    <label for="dob" class="form-label">Birthday</label>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top:8px">
                            <div class="col-12">
                                <div class="form-outline form-white">
                                    <div style="color: #ffff">Gender</div>
                                    <div class="btn-group">
                                        <input type="radio" value="Male" class="btn-check" name="gender" id="gen"
                                               autocomplete="off"/>
                                        <label class="btn btn-white" for="gen">Male</label>

                                        <input type="radio" value="Female" class="btn-check" name="gender" id="gen1"
                                               autocomplete="off"/>
                                        <label class="btn btn-white" for="gen1">Female</label>

                                        <input type="radio" value="Other" class="btn-check" name="gender" id="gen2"
                                               autocomplete="off"/>
                                        <label class="btn btn-white" for="gen2">Other</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top:15px;">
                            <div class="col-md-6 mb-4 pb-2">

                                <div class="form-outline form-white">
                                    <input type="email" id="email" class="form-control form-control-lg"
                                           name="email"/>
                                    <label class="form-label" for="email">Email</label>
                                </div>

                            </div>
                            <div class="col-md-6 mb-4 pb-2">

                                <div class="form-outline form-white">
                                    <input type="tel" id="number" class="form-control form-control-lg"
                                           name="number"/>
                                    <label class="form-label" for="number">Phone Number</label>
                                </div>

                            </div>
                        </div>


                        <div class="row" style="margin-top:8px;">
                            <div class="col-12">
                                <div class="form-outline form-white">
                                    <select id="specialization" name="specialization" class="form-select">

                                    </select>
                                </div>
                            </div>
                        </div>


                        <div class="row" style="margin-top: 10px">
                            <div class="col-6">
                                <button type="button" style="width:100%" class="upbtn btn-light btn-lg"
                                        data-mdb-ripple-color="dark">Update
                                </button>
                            </div>

                            <div class="col-6">
                                <button type="button" style="width:100%" class="delbtn btn-light btn-lg"
                                        data-mdb-ripple-color="dark">Delete
                                </button>
                            </div>
                        </div>


                        <div class="row" style="margin-top:8px;">
                            <div class="col-12">
                                <center>
                                    <div style="color:#FFFF;align-items:center;" id="msg"></div>
                                </center>
                            </div>


                        </div>
                    </div>


                </div>

            </div>
        </div>
    </div>
</div>

<!--     Modal -->
<div class="modal fade" id="iconModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">

                <div class="dhead modal-title">
                    <span><img src="/static/logo1.png" width="80"></span>
                    <span style="padding-left: 10px">Doctor Registration</span>
                </div>
                <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">


                <div class=droot">
                    <div class="dsubdiv">

                         <div class="row" style="margin-top: 10px">
                            <div class="col-12">
                                <div class="form-outline form-white" >
                                    <label class="form-label" for="iconid" style="color:white;margin-bottom:-5px;">Doctor Id</label>
                                    <input type="text" id="iconid" name="iconid"  class="form-control form-control-lg" disabled/>

                                </div>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 10px">
                            <div class="col-6">
                                <img
                                        class="rounded-3"
                                        style="width: 100%;height: 150px "
                                        id="cuimg"
                                        alt="Avatar"
                                />
                            </div>
                            <div class="col-6" style="display:flex; justify-content:center; align-item:center;">
                                <img
                                        src="/static/edit.jpg"
                                        id="editicon"
                                        class="rounded-3"
                                        style="width: 150px;"
                                        alt="Avatar"
                                />
                            </div>

                        </div>

                        <div class="row" style="margin-top: 10px">
                            <div class="col-12">
                                <input name="icon" class="form-control form-white form-control-lg" id="icon"
                                       type="file"/>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 10px">
                            <div class="col-12">
                                <button type="button" style="width:100%" class="updiconbtn btn-light btn-lg"
                                        data-mdb-ripple-color="dark">Update Icon
                                </button>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 4px">
                            <div style="text-align: center;color: #FFF;font-size: 24px" id="iconmsg" class="col-12">

                            </div>
                        </div>

                    </div>
                </div>


            </div>

        </div>
    </div>
</div>


<script>

$('.btnedit').click(function(){

   g=$(this).attr('gender')
        if(g=='Male'){
        $('#gen').attr('checked',true)
        }
        else if(g=='Female'){
        $('#gen1').attr('checked',true)
        }
        else{
        $('#gen2').attr('checked',true)
        }

    var d= new Date($(this).attr('dob'))
    months=['01','02','03','04','05','06','07','08','09','10','11','12']
    year=d.getFullYear()
    month=d.getMonth()
    date=d.getDate()
    if(date<10){
    date='0'+date
    }
    $('#dob').val([year,months[month],date].join('-'))


$('#exampleModal').modal('show');
$('#doctorid').val($(this).attr('doctorid'))
$('#doctorname').val($(this).attr('doctorname'))
$('#email').val($(this).attr('email'))
$('#number').val($(this).attr('number'))
$('#specialization').append($('<option>').text($(this).attr('tspecialization')).val($(this).attr('specialization')))
$.getJSON('/specializationdisplayalljson',function(data){
    data.result.map((item)=>{
    $('#specialization').append($('<option>').text(item.specialization).val(item.specializationid))
    })
})

})

$('.upbtn').click(function(){
    $.getJSON('/updateregistration',{'did':$('#doctorid').val(),'doctorname':$('#doctorname').val(),'dob':$('#dob').val(),'mobileno':$('#number').val(),'email':$('#email').val(),'specialization':$('#specialization').val(),'gender': $('[name="gender"]:checked').val()},function(data)
    {  if(data.result)
        {$('#msg').html('Record Updated Successfully')
        }
        else
        {$('#msg').html('Fail to Update Record...')
        }
   })
})

$('.delbtn').click(function(){
    $.getJSON('/deleteregistration',{'doctorid':$('#doctorid').val()},function(data)
    {  if(data.result)
        {$('#msg').html('Record Deleted Successfully')
        }
        else
        {$('#msg').html('Fail to Delete Record...')
        }
   })
})

$('.btn-close').click(function(){
    location.href="http://localhost:8000/registrationdisplayall/"
})


$('.btnicon').click(function(){

    $('#iconid').val($(this).attr('doctorid'))
    $('#cuimg').attr('src','/static/'+$(this).attr('iconspl'))
})

$('#icon').change(function(event){

  $('#editicon').attr('src',URL.createObjectURL(event.target.files[0]))

})


$('.updiconbtn').click(function(e){

        var formData = new FormData();
        formData.append("doctorid",$('#iconid').val())
        var files=$('#icon')[0].files;

        if(files.length > 0 ){
           formData.append('icon',files[0]);

           $.ajax({
              url: '/editregistrationpicture',
              type: 'post',
              headers:{
        "X-CSRFToken": '{{ csrf_token }}'
         },
              data: formData,
              contentType: false,
              processData: false,
              success: function(response){
                 if(response != 0){
                      if (response.result) {
                $('#iconmsg').html("ICON Updated Successfully")
            } else {
                $('#iconmsg').html("Fail to Update ICON...")
            }

                       }else{
                    alert('file not uploaded');
                 }
              },
           });
        }else{
           alert("Please select a file.");
        }


  })





</script>

</body>
<!-- MDB -->
<script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.2/mdb.min.js"
></script>
</html>


